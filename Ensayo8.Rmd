---
title: "Ensayo 8"
output:
 html_document:
   toc: true
   toc_depth: 5
   toc_float:
     collapsed: false
     smooth_scroll: true
---

# Conservación a 1°C

## Respiración

```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(readxl)
data_fisico<-read_excel("database.xlsx", sheet = "VI UNLP conserva3")

data_fisico$Día<-as.factor(data_fisico$Día)

```

Tabla resumen
```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

data_resp <- na.omit(data_fisico)
data_resp <- data_resp[-c(12),]
library(dplyr)
tabla_resp <- data_resp %>%
  dplyr::group_by(Día) %>%
  dplyr::summarise(n=n(),
                   Mean_resp = mean(respiracion),
                   sd_resp = sd(respiracion))
tabla_resp

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, out.width='95%')

library(ggplot2)
conservacion_resp<-ggplot(tabla_resp, aes(x=Día, y=Mean_resp, fill=Día, width=.4)) +
  stat_summary(fun = "mean", size = 1, geom = "bar", position=position_dodge(0.6), color="black") +
  geom_errorbar(aes(ymin=Mean_resp-sd_resp, ymax=Mean_resp+sd_resp),
                width=.1, position=position_dodge(.6), size=1)+
  scale_fill_manual(values=c("#FF8", "yellow2","orange","brown4"))+
  labs(y="Respiración [mg CO2/ Kg h]")+
  labs(x="Día")+
  labs(fill = "")+
  # facet_grid(Conc~.)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  # theme(legend.title=element_blank())+
  theme(legend.position = "bottom")+
  scale_y_continuous(limits = c(0,60), breaks = seq(0, 60, 10))
conservacion_resp

```

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_respiracion <- lm(respiracion ~ Día, data = data_resp)

```

Modelo
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_respiracion$call

```


```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# Verificación de supuestos
# H_modelo_respiracion <- as.data.frame(cbind(
#   "residuos" = residuals(modelo_respiracion),
#   "predichos" = predict(modelo_respiracion)))
# 
# HV_H_modelo_respiracion<-ggplot(H_modelo_respiracion) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white", size = 6)+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HV_H_modelo_respiracion

```

Análisis de regresión
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(modelo_respiracion)

```

```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=20, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

#Como la interaccion fue signifificativa se comparan #Efectos simples
library(emmeans)
library(dplyr)
m1_emm  <- emmeans(modelo_respiracion, pairwise ~ Día) 
m1_emm

gg_modelo_respiracion <- plot(m1_emm, comparisons = TRUE) +
  labs(x = "Respiración [mg CO2/ Kg h]", y = "") +
  theme_classic() +
  ggtitle("") +
  theme(
    plot.title = element_text(hjust = 0.5, size = rel(1), color = "black"),
    legend.position = 'none',
    panel.grid.major.y = element_line(color = "black", size = 1),
    panel.grid.major.x = element_blank(),
    text = element_text(size = 15, color = 'black'),
    axis.text = element_text(color = 'black', size = 20),
    strip.text.y = element_text(angle = 0, size = 20)
  )

gg_modelo_respiracion

```

## Firmeza

```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(readxl)
data_fisico<-read_excel("database.xlsx", sheet = "VI UNLP conserva3")

data_fisico$Día<-as.factor(data_fisico$Día)

data_fisico <- data_fisico[,-(3:6)]

data_fisico <- na.omit(data_fisico)

```

Tabla resumen
```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)


library(dplyr)
tabla_firmeza <- data_fisico %>%
  dplyr::group_by(Día) %>%
  dplyr::summarise(n=n(),
                   Mean_firmeza = mean(Firmeza),
                   sd_firmeza = sd(Firmeza))
tabla_firmeza

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, out.width='95%')

library(ggplot2)
conservacion_firmeza<-ggplot(tabla_firmeza, aes(x=Día, y=Mean_firmeza, fill=Día, width=.4)) +
  stat_summary(fun = "mean", size = 1, geom = "bar", position=position_dodge(0.6), color="black") +
  geom_errorbar(aes(ymin=Mean_firmeza-sd_firmeza, ymax=Mean_firmeza+sd_firmeza),
                width=.1, position=position_dodge(.6), size=1)+
  scale_fill_manual(values=c("#FF8", "yellow2","orange","brown4"))+
  labs(y="Firmeza [Kg/cm2]")+
  labs(x="Día")+
  labs(fill = "")+
  # facet_grid(Conc~.)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  # theme(legend.title=element_blank())+
  theme(legend.position = "bottom")+
  scale_y_continuous(limits = c(0,2), breaks = seq(0, 2, 0.5))
conservacion_firmeza

```

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_Firmeza <- lm(Firmeza ~ Día, data = data_fisico)

```

Modelo
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_Firmeza$call

```


```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# Verificación de supuestos
# H_modelo_Firmeza <- as.data.frame(cbind(
#   "residuos" = residuals(modelo_Firmeza),
#   "predichos" = predict(modelo_Firmeza)))
# 
# HV_H_modelo_Firmeza<-ggplot(H_modelo_Firmeza) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white", size = 6)+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HV_H_modelo_Firmeza

```

Análisis de la varianza
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(modelo_Firmeza)

```

```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=20, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

#Como la interaccion fue signifificativa se comparan #Efectos simples
library(emmeans)
library(dplyr)
m1_emm  <- emmeans(modelo_Firmeza, pairwise ~ Día) 
m1_emm

gg_modelo_Firmeza <- plot(m1_emm, comparisons = TRUE) +
  labs(x = "Respiración [mg CO2/ Kg h]", y = "") +
  theme_classic() +
  ggtitle("") +
  theme(
    plot.title = element_text(hjust = 0.5, size = rel(1), color = "black"),
    legend.position = 'none',
    panel.grid.major.y = element_line(color = "black", size = 1),
    panel.grid.major.x = element_blank(),
    text = element_text(size = 15, color = 'black'),
    axis.text = element_text(color = 'black', size = 20),
    strip.text.y = element_text(angle = 0, size = 20)
  )

gg_modelo_Firmeza

```

## Colorimetría
### L*

```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(readxl)
data_fisico<-read_excel("database.xlsx", sheet = "VI UNLP conserva3")

data_fisico$Día<-as.factor(data_fisico$Día)

data_fisico <- data_fisico[,-c(2,6)]

data_fisico <- na.omit(data_fisico)

```

Tabla resumen
```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)


library(dplyr)
tabla_L_color <- data_fisico %>%
  dplyr::group_by(Día) %>%
  dplyr::summarise(n=n(),
                   Mean_L_color = mean(L_color),
                   sd_L_color = sd(L_color))
tabla_L_color

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, out.width='95%')

library(ggplot2)
conservacion_L_color<-ggplot(tabla_L_color, aes(x=Día, y=Mean_L_color, fill=Día, width=.4)) +
  stat_summary(fun = "mean", size = 1, geom = "bar", position=position_dodge(0.6), color="black") +
  geom_errorbar(aes(ymin=Mean_L_color-sd_L_color, ymax=Mean_L_color+sd_L_color),
                width=.1, position=position_dodge(.6), size=1)+
  scale_fill_manual(values=c("#FF8", "yellow2","orange","brown4"))+
  labs(y="L*")+
  labs(x="Día")+
  labs(fill = "")+
  # facet_grid(Conc~.)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  # theme(legend.title=element_blank())+
  theme(legend.position = "bottom")+
  scale_y_continuous(limits = c(0,70), breaks = seq(0, 70, 5))
conservacion_L_color

```

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_L_color <- lm(L_color ~ Día, data = data_fisico)

```

Modelo
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_L_color$call

```


```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# Verificación de supuestos
# H_modelo_L_color <- as.data.frame(cbind(
#   "residuos" = residuals(modelo_L_color),
#   "predichos" = predict(modelo_L_color)))
# 
# HV_H_modelo_L_color<-ggplot(H_modelo_L_color) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white", size = 6)+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HV_H_modelo_L_color

```

Análisis de la varianza
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(modelo_L_color)

```

```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=20, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

#Como la interaccion fue signifificativa se comparan #Efectos simples
library(emmeans)
library(dplyr)
m1_emm  <- emmeans(modelo_L_color, pairwise ~ Día) 
m1_emm

gg_modelo_L_color <- plot(m1_emm, comparisons = TRUE) +
  labs(x = "Respiración [mg CO2/ Kg h]", y = "") +
  theme_classic() +
  ggtitle("") +
  theme(
    plot.title = element_text(hjust = 0.5, size = rel(1), color = "black"),
    legend.position = 'none',
    panel.grid.major.y = element_line(color = "black", size = 1),
    panel.grid.major.x = element_blank(),
    text = element_text(size = 15, color = 'black'),
    axis.text = element_text(color = 'black', size = 20),
    strip.text.y = element_text(angle = 0, size = 20)
  )

gg_modelo_L_color

```

### a*

Tabla resumen
```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)


library(dplyr)
tabla_a_color <- data_fisico %>%
  dplyr::group_by(Día) %>%
  dplyr::summarise(n=n(),
                   Mean_a_color = mean(a_color),
                   sd_a_color = sd(a_color))
tabla_a_color

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, out.width='95%')

library(ggplot2)
conservacion_a_color<-ggplot(tabla_a_color, aes(x=Día, y=Mean_a_color, fill=Día, width=.4)) +
  stat_summary(fun = "mean", size = 1, geom = "bar", position=position_dodge(0.6), color="black") +
  geom_errorbar(aes(ymin=Mean_a_color-sd_a_color, ymax=Mean_a_color+sd_a_color),
                width=.1, position=position_dodge(.6), size=1)+
  scale_fill_manual(values=c("#FF8", "yellow2","orange","brown4"))+
  labs(y="Respiración [mg CO2/ Kg h]")+
  labs(x="Día")+
  labs(fill = "")+
  # facet_grid(Conc~.)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  # theme(legend.title=element_blank())+
  theme(legend.position = "bottom")+
  scale_y_continuous(limits = c(0,20), breaks = seq(0, 20, 1))
conservacion_a_color

```

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_a_color <- lm(a_color ~ Día, data = data_fisico)

```

Modelo
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_a_color$call

```


```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# Verificación de supuestos
# H_modelo_a_color <- as.data.frame(cbind(
#   "residuos" = residuals(modelo_a_color),
#   "predichos" = predict(modelo_a_color)))
# 
# HV_H_modelo_a_color<-ggplot(H_modelo_a_color) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white", size = 6)+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HV_H_modelo_a_color

```

Análisis de la varianza
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(modelo_a_color)

```

```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=20, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

#Como la interaccion fue signifificativa se comparan #Efectos simples
library(emmeans)
library(dplyr)
m1_emm  <- emmeans(modelo_a_color, pairwise ~ Día) 
m1_emm

gg_modelo_a_color <- plot(m1_emm, comparisons = TRUE) +
  labs(x = "Respiración [mg CO2/ Kg h]", y = "") +
  theme_classic() +
  ggtitle("") +
  theme(
    plot.title = element_text(hjust = 0.5, size = rel(1), color = "black"),
    legend.position = 'none',
    panel.grid.major.y = element_line(color = "black", size = 1),
    panel.grid.major.x = element_blank(),
    text = element_text(size = 15, color = 'black'),
    axis.text = element_text(color = 'black', size = 20),
    strip.text.y = element_text(angle = 0, size = 20)
  )

gg_modelo_a_color

```

### b*

Tabla resumen
```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)
tabla_b_color <- data_fisico %>%
  dplyr::group_by(Día) %>%
  dplyr::summarise(n=n(),
                   Mean_b_color = mean(b_color),
                   sd_b_color = sd(b_color))
tabla_b_color

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, out.width='95%')

library(ggplot2)
conservacion_b_color<-ggplot(tabla_b_color, aes(x=Día, y=Mean_b_color, fill=Día, width=.4)) +
  stat_summary(fun = "mean", size = 1, geom = "bar", position=position_dodge(0.6), color="black") +
  geom_errorbar(aes(ymin=Mean_b_color-sd_b_color, ymax=Mean_b_color+sd_b_color),
                width=.1, position=position_dodge(.6), size=1)+
  scale_fill_manual(values=c("#FF8", "yellow2","orange","brown4"))+
  labs(y="Respiración [mg CO2/ Kg h]")+
  labs(x="Día")+
  labs(fill = "")+
  # facet_grid(Conc~.)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  # theme(legend.title=element_blank())+
  theme(legend.position = "bottom")+
  scale_y_continuous(limits = c(0,60), breaks = seq(0, 60, 5))
conservacion_b_color

```

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_b_color <- lm(b_color ~ Día, data = data_fisico)

```

Modelo
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_b_color$call

```


```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# Verificación de supuestos
# H_modelo_b_color <- as.data.frame(cbind(
#   "residuos" = residuals(modelo_b_color),
#   "predichos" = predict(modelo_b_color)))
# 
# HV_H_modelo_b_color<-ggplot(H_modelo_b_color) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white", size = 6)+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HV_H_modelo_b_color

```

Análisis de la varianza
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(modelo_b_color)

```

```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=20, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

#Como la interaccion fue signifificativa se comparan #Efectos simples
library(emmeans)
library(dplyr)
m1_emm  <- emmeans(modelo_b_color, pairwise ~ Día) 
m1_emm

gg_modelo_b_color <- plot(m1_emm, comparisons = TRUE) +
  labs(x = "Respiración [mg CO2/ Kg h]", y = "") +
  theme_classic() +
  ggtitle("") +
  theme(
    plot.title = element_text(hjust = 0.5, size = rel(1), color = "black"),
    legend.position = 'none',
    panel.grid.major.y = element_line(color = "black", size = 1),
    panel.grid.major.x = element_blank(),
    text = element_text(size = 15, color = 'black'),
    axis.text = element_text(color = 'black', size = 20),
    strip.text.y = element_text(angle = 0, size = 20)
  )

gg_modelo_b_color

```

## Actividad antioxidante

```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(readxl)
data_aao<-read_excel("database.xlsx", sheet = "VI UNLP conserva1")

data_aao$Día<-as.factor(data_aao$Día)
data_aao$Rep<-as.factor(data_aao$Rep)
data_aao$Conc<-as.factor(data_aao$Conc)

```

Tabla resumen
```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)
tabla_aao <- data_aao %>%
  dplyr::group_by(Día, Conc) %>%
  dplyr::summarise(n=n(),
                   Mean_aao = mean(aao),
                   sd_aao = sd(aao))
tabla_aao
```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, out.width='95%')

library(ggplot2)
conservacion_aao<-ggplot(tabla_aao, aes(x=Día, y=Mean_aao, fill=Conc, width=.4)) +
  stat_summary(fun = "mean", size = 1, geom = "bar", position=position_dodge(0.6), color="black") +
  geom_errorbar(aes(ymin=Mean_aao-sd_aao, ymax=Mean_aao+sd_aao),
                width=.1, position=position_dodge(.6), size=1)+
  scale_fill_manual(values=c("#FF8","orange","brown4"))+
  labs(y="Actividad Antioxidante [%]")+
  labs(x="Día")+
  labs(fill = "mg peso seco / ml")+
  # facet_grid(Conc~.)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  # theme(legend.title=element_blank())+
  theme(legend.position = "bottom")+
  scale_y_continuous(limits = c(0, 105), breaks = seq(0, 100, 20))
conservacion_aao

```


```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# library(lmerTest)
# library(lme4)
# modelo_aao <- lmer(aao ~ Día + (1|Conc), data = data)

library(glmmTMB)
modelo_aao_2 <- glmmTMB(aao/100 ~ Día + (1|Conc), family = beta_family(link = "logit"), data = data_aao)

```

Modelo
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_aao_2

```


```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# Verificación de supuestos
# H_modelo_aao <- as.data.frame(cbind(
#   "residuos" = residuals(modelo_aao_2),
#   "predichos" = predict(modelo_aao_2)))
# 
# HV_H_modelo_aao2<-ggplot(H_modelo_aao) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white", size = 6)+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HV_H_modelo_aao2

```

Anova
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(car)
Anova(modelo_aao_2)

```

Comparaciones a posteriori
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
library(emmeans)
library(multcompView)
emm_options(opt.digits = FALSE)
Comp_modelo_aao_2<-emmeans(modelo_aao_2, pairwise ~ Día, type="response") 
confint(Comp_modelo_aao_2)

# Resumen de los resultados
summary_results <- summary(Comp_modelo_aao_2)

gg_Comp_modelo_aao_2 <- plot(Comp_modelo_aao_2, comparisons = TRUE)+ 
labs(x = "Actividad Antioxidante [%/100]", y ="Días")+
  annotate("text", x = 0.397492120  , y = 1.2 , label = "a", size=6)+
  annotate("text", x = 0.236860543  , y = 2.2 , label = "b", size=6)+
  annotate("text", x = 0.140148761  , y = 3.2 , label = "c", size=6)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  scale_x_continuous(limits = c(0, 1), breaks = seq(0, 1, 0.2))
gg_Comp_modelo_aao_2

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, out.width='95%')

response_data <- data.frame(confint(Comp_modelo_aao_2$emmeans))

response_data$Tratamiento <- as.factor(response_data$Día)

library(ggplot2)
sec_uba_aao_comp<-ggplot(response_data, aes(x=Día, y=response*100, fill = Día)) +
  geom_bar(stat = "identity", width=.4, color='black', size = 1) +
  geom_errorbar(aes(ymin = response*100-SE *100, ymax = response*100+SE*100), width = 0.2, position = "dodge", color='black', size = 1)+
  scale_fill_manual(values=c("#FF8","orange","brown4"))+
  labs(y="Actividad Antioxidante [%]", x="")+
  labs(x="")+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  # theme(legend.title=element_blank())+
  theme(legend.position = "bottom")+
  scale_y_continuous(limits = c(0, 0.50*100), breaks = seq(0, 0.5*100, 0.10*100))+
  annotate("text", y = 0.397492120 *100+0.1*0.397492120 *100 , x = 1.05 , label = "a",size=10)+
  annotate("text", y = 0.236860543  *100+0.1*0.236860543 *100 , x = 2.05 , label = "b",size=10)+
  annotate("text", y = 0.140148761  *100+0.1*0.140148761 *100 , x = 3.05 , label = "c",size=10)
sec_uba_aao_comp

```

## Fenoles
```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(readxl)
data<-read_excel("database.xlsx", sheet = "VI UNLP conserva2")
data$Día<-as.factor(data$Día)
data$Rep<-as.factor(data$Rep)

data <- data[-c(10:18),]

```

```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)
tabla_fenoles <- data %>%
  dplyr::group_by(Día) %>%
  dplyr::summarise(n=n(),
                   Mean_fenoles = mean(Fenoles),
                   sd_fenoles = sd(Fenoles))
tabla_fenoles
```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, out.width='95%')

# gradiente_azul <- colorRampPalette(c("blue4", "grey"))(3)

library(ggplot2)
conservacion_fenoles<-ggplot(tabla_fenoles, aes(x=Día, y=Mean_fenoles, fill=Día, width=.4)) +
  stat_summary(fun = "mean", size = 1, geom = "bar", position=position_dodge(0.6), color="black") +
  geom_errorbar(aes(ymin=Mean_fenoles-sd_fenoles, ymax=Mean_fenoles+sd_fenoles),
                width=.1, position=position_dodge(.6), size=1)+
  scale_fill_manual(values=c("#FF8","orange","brown4"))+
  labs(y="Fenoles [mg Tán/100g PF]", x="")+
  labs(x="", x="")+
  # facet_grid(Conc~.)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  # theme(legend.title=element_blank())+
  theme(legend.position = "bottom")+
  scale_y_continuous(limits = c(00, 110), breaks = seq(00, 110, 20))
conservacion_fenoles

```

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

data$Día<-as.numeric(data$Día)

modelo_fenoles <- lm(Fenoles ~ Día, data = data)

```

Modelo
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_fenoles$call

```

Análisis de regresión
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

summary(modelo_fenoles)

```

Por cada día transcurrido los frutos pierden en promedio -2.37 mg eq. Tán/100g PF (p=0.041)

Análisis de la varianza
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(readxl)
data<-read_excel("database.xlsx", sheet = "VI UNLP conserva2")
data$Día<-as.factor(data$Día)
data$Rep<-as.factor(data$Rep)

data <- data[-c(10:18),]

modelo_fenoles <- lm(Fenoles ~ Día, data = data)

anova(modelo_fenoles)

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# Verificación de supuestos
# H_modelo_fenoles <- as.data.frame(cbind(
#   "residuos" = residuals(modelo_fenoles),
#   "predichos" = predict(modelo_fenoles)))
# 
# HV_H_modelo_fenoles<-ggplot(H_modelo_fenoles) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white", size = 6)+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HV_H_modelo_fenoles

```

```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=20, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# #Como la interaccion fue signifificativa se comparan #Efectos simples
# library(emmeans)
# library(dplyr)
# m1_emm  <- emmeans(modelo_fenoles, pairwise ~ Día) 
# m1_emm
# 
# gg_modelo_fenoles <- plot(m1_emm, comparisons = TRUE) +
#   labs(x = "Respiración [mg CO2/ Kg h]", y = "") +
#   theme_classic() +
#   ggtitle("") +
#   theme(
#     plot.title = element_text(hjust = 0.5, size = rel(1), color = "black"),
#     legend.position = 'none',
#     panel.grid.major.y = element_line(color = "black", size = 1),
#     panel.grid.major.x = element_blank(),
#     text = element_text(size = 15, color = 'black'),
#     axis.text = element_text(color = 'black', size = 20),
#     strip.text.y = element_text(angle = 0, size = 20)
#   )
# 
# gg_modelo_fenoles

```

## Correlación AAO y fenoles

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)
data2 <- data_aao %>%
  dplyr::filter(Conc == 0.5) %>%
  dplyr::group_by(Día, Rep) %>%
  dplyr::summarise(aao = mean(aao))

data4 <- data %>%
  dplyr::group_by(Día, Rep) %>%
  dplyr::summarise(Fenoles = mean(Fenoles))

data3 <- merge(data4, data2)

modelo_reg <- lm (aao ~ Fenoles, data=data3)


```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

summary(modelo_reg)

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

cor(data3$Fenoles,data3$aao)

```

Hay evidencia para aceptar que beta1 difiere de cero (r = 0.791, valor p = 0.011 )
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

colores <- c("#FF8","orange","brown4")

newdata <- data.frame(Fenoles = seq(min(data3$Fenoles), max(data3$Fenoles), length.out = 100), Tratamiento = factor("Día"))
newdata$aao <- predict(modelo_reg, newdata = newdata, type = "re")

gg_cor_con_aao_fenoles <- ggplot(data3, aes(x = Fenoles, y = aao)) +
  geom_point(aes(color = factor(Día)), size = 8) +
  geom_line(data = newdata, aes(x = Fenoles, y = aao), size=1.2)+
  labs(x="Fenoles [mg Tán/100g PF]", y="Actividad Antioxidante [%]")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_color_manual(values = colores) +
  # theme(legend.title=element_blank())+
  theme(legend.position='bottom')+
  theme(panel.grid.major.y = element_line(color="black", size=0.05))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1, color='black'))+
  theme(axis.text.y = element_text(angle = 0, hjust = 1, color='black'))+
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, 20))+
  scale_x_continuous(limits = c(50, 110), breaks = seq(50, 110, 10))
gg_cor_con_aao_fenoles

```

## Carotenoides
```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
library(readxl)
data<-read_excel("database.xlsx", sheet = "VI UNLP conserva2")

data$Día<-as.factor(data$Día)
data$Rep<-as.factor(data$Rep)

```

```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)
tabla_Carotenoides <- data %>%
  dplyr::group_by(Día) %>%
  dplyr::summarise(n=n(),
                   Mean_Carotenoides = mean(Carotenoides),
                   sd_Carotenoides = sd(Carotenoides))
tabla_Carotenoides

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, out.width='95%')

# gradiente_azul <- colorRampPalette(c("orange3", "grey"))(3)

library(ggplot2)
conservacion_Carotenoides<-ggplot(tabla_Carotenoides, aes(x=Día, y=Mean_Carotenoides, fill=Día, width=.4)) +
  stat_summary(fun = "mean", size = 1, geom = "bar", position=position_dodge(0.6), color="black") +
  geom_errorbar(aes(ymin=Mean_Carotenoides-sd_Carotenoides, ymax=Mean_Carotenoides+sd_Carotenoides),
                width=.1, position=position_dodge(.6), size=1)+
  scale_fill_manual(values=c("#FF8","orange","brown4"))+
  labs(y="Carotenoides [µg/g PS]", x="")+
  labs(x="", x="")+
  # facet_grid(Conc~.)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  # theme(legend.title=element_blank())+
  theme(legend.position = "bottom")+
  scale_y_continuous(limits = c(00, 400), breaks = seq(00, 400, 40))
  # annotate("text", y = 205+10  , x = 1.1 , label = "b", size=6)+
  # annotate("text", y = 298+10  , x = 2.1 , label = "a", size=6)+
  # annotate("text", y = 193+10  , x = 3.1 , label = "b", size=6)
conservacion_Carotenoides

```

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_Carotenoides <- lm(Carotenoides ~ Día, data = data)

```

Modelo
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_Carotenoides$call

```


```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# Verificación de supuestos
# H_modelo_Carotenoides <- as.data.frame(cbind(
#   "residuos" = residuals(modelo_Carotenoides),
#   "predichos" = predict(modelo_Carotenoides)))
# 
# HV_H_modelo_Carotenoides<-ggplot(H_modelo_Carotenoides) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white", size = 6)+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HV_H_modelo_Carotenoides

```

ANOVA
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(modelo_Carotenoides)

```

Comparaciones a posteriori
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
library(emmeans)
library(multcompView)
emm_options(opt.digits = FALSE)
Comp_modelo_Carotenoides<-emmeans(modelo_Carotenoides, pairwise ~ Día, type="response") 
# confint(modelo_Carotenoides)
Comp_modelo_Carotenoides
# Resumen de los resultados
summary_results <- summary(Comp_modelo_Carotenoides)

gg_Comp_modelo_aao_2 <- plot(Comp_modelo_Carotenoides, comparisons = TRUE)+ 
labs(x = "Carotenoides [µg/g PS]", y ="Días")+
  annotate("text", x = 205  , y = 1.2 , label = "b", size=6)+
  annotate("text", x = 298  , y = 2.2 , label = "a", size=6)+
  annotate("text", x = 193  , y = 3.2 , label = "b", size=6)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  scale_x_continuous(limits = c(160, 360), breaks = seq(160, 360, 40))
gg_Comp_modelo_aao_2

```
A los 7 días se encontró un aumento significativo en la concentración de carotenoides (p=0.009 )

## Clorofila a

```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)
tabla_Clorofila_a <- data %>%
  dplyr::group_by(Día) %>%
  dplyr::summarise(n=n(),
                   Mean_Clorofila_a = mean(Clorofila_a),
                   sd_Clorofila_a = sd(Clorofila_a))
tabla_Clorofila_a

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, out.width='95%')

# gradiente_azul <- colorRampPalette(c("orange3", "grey"))(3)

library(ggplot2)
conservacion_Clorofila_a<-ggplot(tabla_Clorofila_a, aes(x=Día, y=Mean_Clorofila_a, fill=Día, width=.4)) +
  stat_summary(fun = "mean", size = 1, geom = "bar", position=position_dodge(0.6), color="black") +
  geom_errorbar(aes(ymin=Mean_Clorofila_a-sd_Clorofila_a, ymax=Mean_Clorofila_a+sd_Clorofila_a),
                width=.1, position=position_dodge(.6), size=1)+
  scale_fill_manual(values=c("#FF8","orange","brown4"))+
  labs(y="Clorofila_a [µg/g PS]", x="")+
  labs(x="", x="")+
  # facet_grid(Conc~.)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  # theme(legend.title=element_blank())+
  theme(legend.position = "bottom")+
  scale_y_continuous(limits = c(00, 50), breaks = seq(00, 50, 10))
# annotate("text", y = 205+10  , x = 1.1 , label = "b", size=6)+
# annotate("text", y = 298+10  , x = 2.1 , label = "a", size=6)+
# annotate("text", y = 193+10  , x = 3.1 , label = "b", size=6)
conservacion_Clorofila_a

```

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_Clorofila_a <- lm(Clorofila_a ~ Día, data = data)

```

Modelo
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_Clorofila_a$call

```


```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# Verificación de supuestos
# H_modelo_Clorofila_a <- as.data.frame(cbind(
#   "residuos" = residuals(modelo_Clorofila_a),
#   "predichos" = predict(modelo_Clorofila_a)))
# 
# HV_H_modelo_Clorofila_a<-ggplot(H_modelo_Clorofila_a) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white", size = 6)+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HV_H_modelo_Clorofila_a

```

ANOVA
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(modelo_Clorofila_a)

```

Comparaciones a posteriori
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
library(emmeans)
library(multcompView)
emm_options(opt.digits = FALSE)
Comp_modelo_Clorofila_a<-emmeans(modelo_Clorofila_a, pairwise ~ Día, type="response") 
# confint(modelo_Clorofila_a)
Comp_modelo_Clorofila_a
# Resumen de los resultados
summary_results <- summary(Comp_modelo_Clorofila_a)

gg_Comp_modelo_aao_2 <- plot(Comp_modelo_Clorofila_a, comparisons = TRUE)+ 
  labs(x = "Clorofila_a [µg/g PS]", y ="Días")+
  annotate("text", x = 31.4  , y = 1.2 , label = "a", size=6)+
  annotate("text", x = 24.8  , y = 2.2 , label = "a", size=6)+
  annotate("text", x = 9.91  , y = 3.2 , label = "b", size=6)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  scale_x_continuous(limits = c(0, 40), breaks = seq(0, 40, 10))
gg_Comp_modelo_aao_2

```

## Clorofila b

```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)
tabla_Clorofila_b <- data %>%
  dplyr::group_by(Día) %>%
  dplyr::summarise(n=n(),
                   Mean_Clorofila_b = mean(Clorofila_b),
                   sd_Clorofila_b = sd(Clorofila_b))
tabla_Clorofila_b

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, out.width='95%')

# gradiente_azul <- colorRampPalette(c("orange3", "grey"))(3)

library(ggplot2)
conservacion_Clorofila_b<-ggplot(tabla_Clorofila_b, aes(x=Día, y=Mean_Clorofila_b, fill=Día, width=.4)) +
  stat_summary(fun = "mean", size = 1, geom = "bar", position=position_dodge(0.6), color="black") +
  geom_errorbar(aes(ymin=Mean_Clorofila_b-sd_Clorofila_b, ymax=Mean_Clorofila_b+sd_Clorofila_b),
                width=.1, position=position_dodge(.6), size=1)+
  scale_fill_manual(values=c("#FF8","orange","brown4"))+
  labs(y="Clorofila_b [µg/g PS]", x="")+
  labs(x="", x="")+
  # facet_grid(Conc~.)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  # theme(legend.title=element_blank())+
  theme(legend.position = "bottom")+
  scale_y_continuous(limits = c(00, 80), breaks = seq(00, 80, 10))
# annotate("text", y = 205+10  , x = 1.1 , label = "b", size=6)+
# annotate("text", y = 298+10  , x = 2.1 , label = "a", size=6)+
# annotate("text", y = 193+10  , x = 3.1 , label = "b", size=6)
conservacion_Clorofila_b

```

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_Clorofila_b <- lm(Clorofila_b ~ Día, data = data)

```

Modelo
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_Clorofila_b$call

```


```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# Verificación de supuestos
# H_modelo_Clorofila_b <- as.data.frame(cbind(
#   "residuos" = residuals(modelo_Clorofila_b),
#   "predichos" = predict(modelo_Clorofila_b)))
# 
# HV_H_modelo_Clorofila_b<-ggplot(H_modelo_Clorofila_b) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white", size = 6)+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HV_H_modelo_Clorofila_b

```

ANOVA
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(modelo_Clorofila_b)

```

Comparaciones a posteriori
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
library(emmeans)
library(multcompView)
emm_options(opt.digits = FALSE)
Comp_modelo_Clorofila_b<-emmeans(modelo_Clorofila_b, pairwise ~ Día, type="response") 
# confint(modelo_Clorofila_b)
Comp_modelo_Clorofila_b
# Resumen de los resultados
summary_results <- summary(Comp_modelo_Clorofila_b)

gg_Comp_modelo_aao_2 <- plot(Comp_modelo_Clorofila_b, comparisons = TRUE)+ 
  labs(x = "Clorofila_b [µg/g PS]", y ="Días")+
  annotate("text", x = 53.9  , y = 1.2 , label = "a", size=6)+
  annotate("text", x = 42.7  , y = 2.2 , label = "a", size=6)+
  annotate("text", x = 16.9  , y = 3.2 , label = "b", size=6)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  scale_x_continuous(limits = c(0, 80), breaks = seq(0, 80, 10))
gg_Comp_modelo_aao_2

```

## Correlación AAO y Carotenoides

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

data2 <- data_aao %>%
  dplyr::filter(Conc == 0.5) %>%
  dplyr::group_by(Día, Rep) %>%
  dplyr::summarise(aao = mean(aao))

data5 <- data %>%
  dplyr::filter(Rep %in% c(1,2,3)) %>%
  dplyr::group_by(Día, Rep) %>%
  dplyr::summarise(Carotenoides = mean(Carotenoides))


data3 <- merge(data5, data2)

modelo_reg <- lm (aao ~ Carotenoides, data=data3)


```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

summary(modelo_reg)

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

cor(data3$Carotenoides,data3$aao)

```

No existe evidencia para aceptar que beta1 difiere de cero (r = -0.004, valor p = 0.990)
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

colores <- c("#FF8","orange","brown4")

newdata <- data.frame(Carotenoides = seq(min(data3$Carotenoides), max(data3$Carotenoides), length.out = 100), Tratamiento = factor("Día"))
newdata$aao <- predict(modelo_reg, newdata = newdata, type = "re")

gg_cor_con_aao_Carotenoides <- ggplot(data3, aes(x = Carotenoides, y = aao)) +
  geom_point(aes(color = factor(Día)), size = 8) +
  geom_line(data = newdata, aes(x = Carotenoides, y = aao), size=1.2)+
  labs(x="Carotenoides [µg/g PS]", y="Actividad Antioxidante [%]")+
  theme_classic()+
  theme(plot.title = element_text(hjust = 0.5, size = rel(1.5))) +
  scale_color_manual(values = colores) +
  theme(legend.title=element_blank())+
  theme(legend.position='bottom')+
  theme(panel.grid.major.y = element_line(color="black", size=0.05))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text.x = element_text(angle = 45, hjust = 1, color='black'))+
  theme(axis.text.y = element_text(angle = 0, hjust = 1, color='black'))+
  scale_y_continuous(limits = c(0, 100), breaks = seq(0, 100, 20))+
  scale_x_continuous(limits = c(0, 400), breaks = seq(0, 4000, 80))
gg_cor_con_aao_Carotenoides
```
No existe evidencia para aceptar que beta1 difiere de cero (r = 0.082, valor p = 0.8330)

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

#Renderizar a .pdf
# rmarkdown::render("VI_UNLP_1.Rmd", output_format = "pdf_document")

```

## Acidez total titulable

```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(readxl)
data<-read_excel("database.xlsx", sheet = "VI UNLP conserva2")
data$Día<-as.factor(data$Día)
data$Rep<-as.factor(data$Rep)

data <- data[-c(10:18),]

```

```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)
tabla_Acidez <- data %>%
  dplyr::group_by(Día) %>%
  dplyr::summarise(n=n(),
                   Mean_Acidez = mean(Acidez),
                   sd_Acidez = sd(Acidez))
tabla_Acidez
```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, out.width='95%')

library(ggplot2)
conservacion_Acidez<-ggplot(tabla_Acidez, aes(x=Día, y=Mean_Acidez, fill=Día, width=.4)) +
  stat_summary(fun = "mean", size = 1, geom = "bar", position=position_dodge(0.6), color="black") +
  geom_errorbar(aes(ymin=Mean_Acidez-sd_Acidez, ymax=Mean_Acidez+sd_Acidez),
                width=.1, position=position_dodge(.6), size=1)+
  scale_fill_manual(values=c("#FF8","orange","brown4"))+
  labs(y="Acidez total titulable [%]", x="")+
  labs(x="", x="")+
  # facet_grid(Conc~.)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  # theme(legend.title=element_blank())+
  theme(legend.position = "bottom")+
  scale_y_continuous(limits = c(00, 3), breaks = seq(00, 3, 0.5))
conservacion_Acidez

```

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_Acidez <- lm(Acidez ~ Día, data = data)

```

Modelo
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_Acidez$call

```


```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# Verificación de supuestos
# H_modelo_Acidez <- as.data.frame(cbind(
#   "residuos" = residuals(modelo_Acidez),
#   "predichos" = predict(modelo_Acidez)))
# 
# HV_H_modelo_Acidez<-ggplot(H_modelo_Acidez) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white", size = 6)+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HV_H_modelo_Acidez

```

Análisis de regresión
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(modelo_Acidez)

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
library(emmeans)
library(multcompView)
emm_options(opt.digits = FALSE)
Comp_modelo_Acidez<-emmeans(modelo_Acidez, pairwise ~ Día, type="response") 
# confint(modelo_Acidez)
Comp_modelo_Acidez
# Resumen de los resultados
summary_results <- summary(Comp_modelo_Acidez)

gg_Comp_modelo_aao_2 <- plot(Comp_modelo_Acidez, comparisons = TRUE)+ 
  labs(x = "Acidez [µg/g PS]", y ="Días")+
  annotate("text", x = 2  , y = 1.2 , label = "a", size=6)+
  annotate("text", x = 1.7  , y = 2.2 , label = "b", size=6)+
  annotate("text", x = 1.6  , y = 3.2 , label = "b", size=6)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  scale_x_continuous(limits = c(0, 3), breaks = seq(0, 3, 1))
gg_Comp_modelo_aao_2

```


## pH inicial

```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)
tabla_pH_inicial <- data %>%
  dplyr::group_by(Día) %>%
  dplyr::summarise(n=n(),
                   Mean_pH_inicial = mean(pH_inicial),
                   sd_pH_inicial = sd(pH_inicial))
tabla_pH_inicial
```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, out.width='95%')

library(ggplot2)
conservacion_pH_inicial<-ggplot(tabla_pH_inicial, aes(x=Día, y=Mean_pH_inicial, fill=Día, width=.4)) +
  stat_summary(fun = "mean", size = 1, geom = "bar", position=position_dodge(0.6), color="black") +
  geom_errorbar(aes(ymin=Mean_pH_inicial-sd_pH_inicial, ymax=Mean_pH_inicial+sd_pH_inicial),
                width=.1, position=position_dodge(.6), size=1)+
  scale_fill_manual(values=c("#FF8","orange","brown4"))+
  labs(y="pH_inicial total titulable [%]", x="")+
  labs(x="", x="")+
  # facet_grid(Conc~.)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  # theme(legend.title=element_blank())+
  theme(legend.position = "bottom")+
  scale_y_continuous(limits = c(00, 5), breaks = seq(00, 5, 1))
conservacion_pH_inicial

```

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_pH_inicial <- lm(pH_inicial ~ Día, data = data)

```

Modelo
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_pH_inicial$call

```


```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# Verificación de supuestos
# H_modelo_pH_inicial <- as.data.frame(cbind(
#   "residuos" = residuals(modelo_pH_inicial),
#   "predichos" = predict(modelo_pH_inicial)))
# 
# HV_H_modelo_pH_inicial<-ggplot(H_modelo_pH_inicial) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white", size = 6)+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HV_H_modelo_pH_inicial

```

Análisis de regresión
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(modelo_pH_inicial)

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
library(emmeans)
library(multcompView)
emm_options(opt.digits = FALSE)
Comp_modelo_pH_inicial<-emmeans(modelo_pH_inicial, pairwise ~ Día, type="response") 
# confint(modelo_pH_inicial)
Comp_modelo_pH_inicial
# Resumen de los resultados
summary_results <- summary(Comp_modelo_pH_inicial)

gg_Comp_modelo_aao_2 <- plot(Comp_modelo_pH_inicial, comparisons = TRUE)+ 
  labs(x = "pH_inicial [µg/g PS]", y ="Días")+
  annotate("text", x = 3.3  , y = 1.2 , label = "b", size=6)+
  annotate("text", x = 3.4  , y = 2.2 , label = "a", size=6)+
  annotate("text", x = 3.4  , y = 3.2 , label = "a", size=6)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  scale_x_continuous(limits = c(3, 3.5), breaks = seq(3, 3.5, 0.5))
gg_Comp_modelo_aao_2

```

## Ratio

```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)
tabla_Ratio <- data %>%
  dplyr::group_by(Día) %>%
  dplyr::summarise(n=n(),
                   Mean_Ratio = mean(Ratio),
                   sd_Ratio = sd(Ratio))
tabla_Ratio
```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, out.width='95%')

library(ggplot2)
conservacion_Ratio<-ggplot(tabla_Ratio, aes(x=Día, y=Mean_Ratio, fill=Día, width=.4)) +
  stat_summary(fun = "mean", size = 1, geom = "bar", position=position_dodge(0.6), color="black") +
  geom_errorbar(aes(ymin=Mean_Ratio-sd_Ratio, ymax=Mean_Ratio+sd_Ratio),
                width=.1, position=position_dodge(.6), size=1)+
  scale_fill_manual(values=c("#FF8","orange","brown4"))+
  labs(y="Ratio total titulable [%]", x="")+
  labs(x="", x="")+
  # facet_grid(Conc~.)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  # theme(legend.title=element_blank())+
  theme(legend.position = "bottom")+
  scale_y_continuous(limits = c(00, 6), breaks = seq(00, 6, 1))
conservacion_Ratio

```

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_Ratio <- lm(Ratio ~ Día, data = data)

```

Modelo
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_Ratio$call

```


```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# Verificación de supuestos
# H_modelo_Ratio <- as.data.frame(cbind(
#   "residuos" = residuals(modelo_Ratio),
#   "predichos" = predict(modelo_Ratio)))
# 
# HV_H_modelo_Ratio<-ggplot(H_modelo_Ratio) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white", size = 6)+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HV_H_modelo_Ratio

```

Análisis de regresión
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(modelo_Ratio)

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
library(emmeans)
library(multcompView)
emm_options(opt.digits = FALSE)
Comp_modelo_Ratio<-emmeans(modelo_Ratio, pairwise ~ Día, type="response") 
# confint(modelo_Ratio)
Comp_modelo_Ratio
# Resumen de los resultados
summary_results <- summary(Comp_modelo_Ratio)

gg_Comp_modelo_aao_2 <- plot(Comp_modelo_Ratio, comparisons = TRUE)+ 
  labs(x = "Ratio [µg/g PS]", y ="Días")+
  annotate("text", x = 53.9  , y = 1.2 , label = "a", size=6)+
  annotate("text", x = 42.7  , y = 2.2 , label = "a", size=6)+
  annotate("text", x = 16.9  , y = 3.2 , label = "b", size=6)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  scale_x_continuous(limits = c(0, 80), breaks = seq(0, 80, 10))
gg_Comp_modelo_aao_2

```

## Sólidos solubles

```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(readxl)
data<-read_excel("database.xlsx", sheet = "VI UNLP conserva2")
data$Día<-as.factor(data$Día)
data$Rep<-as.factor(data$Rep)

data <- data[-c(10:18),]

```

```{r, echo=FALSE, fig.align='center', fig.asp=0.4}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)
tabla_Solidos <- data %>%
  dplyr::group_by(Día) %>%
  dplyr::summarise(n=n(),
                   Mean_Solidos = mean(Solidos),
                   sd_Solidos = sd(Solidos))
tabla_Solidos
```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE, out.width='95%')

library(ggplot2)
conservacion_Solidos<-ggplot(tabla_Solidos, aes(x=Día, y=Mean_Solidos, fill=Día, width=.4)) +
  stat_summary(fun = "mean", size = 1, geom = "bar", position=position_dodge(0.6), color="black") +
  geom_errorbar(aes(ymin=Mean_Solidos-sd_Solidos, ymax=Mean_Solidos+sd_Solidos),
                width=.1, position=position_dodge(.6), size=1)+
  scale_fill_manual(values=c("#FF8","orange","brown4"))+
  labs(y="Solidos [°Brix]", x="")+
  labs(x="", x="")+
  # facet_grid(Conc~.)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  # theme(legend.title=element_blank())+
  theme(legend.position = "bottom")+
  scale_y_continuous(limits = c(00, 10), breaks = seq(00, 10, 2))
conservacion_Solidos

```

```{r  , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_Solidos <- lm(Solidos ~ Día, data = data)

```

Modelo
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

modelo_Solidos$call

```


```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# Verificación de supuestos
# H_modelo_Solidos <- as.data.frame(cbind(
#   "residuos" = residuals(modelo_Solidos),
#   "predichos" = predict(modelo_Solidos)))
# 
# HV_H_modelo_Solidos<-ggplot(H_modelo_Solidos) +
#   aes(predichos, residuos) +
#   geom_hline(yintercept = 0, colour="white", size=2) +
#   geom_point(colour="white", size = 6)+
#   theme_classic()+
#   labs(y="Residuals", x="Predicted values")+
#   theme(legend.position = "bottom", legend.background = element_rect(fill = "gray12"))+
#   theme(panel.grid.major.y = element_line(size=0.05, color='white'))+
#   theme(panel.grid.major.x = element_blank())+
#   theme(text = element_text(size=10, color='white'))+
#   theme(axis.text = element_text(color='white'))+
#   theme(plot.background = element_rect(fill = "gray12"))+
#   theme(panel.background = element_rect(fill = "gray12", color = "white"))
# HV_H_modelo_Solidos

```

Análisis de regresión
```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

anova(modelo_Solidos)

```

```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(ggplot2)
library(emmeans)
library(multcompView)
emm_options(opt.digits = FALSE)
Comp_modelo_Solidos<-emmeans(modelo_Solidos, pairwise ~ Día, type="response") 
# confint(modelo_Ratio)
Comp_modelo_Solidos
# Resumen de los resultados
summary_results <- summary(Comp_modelo_Solidos)

gg_Comp_modelo_aao_2 <- plot(Comp_modelo_Solidos, comparisons = TRUE)+ 
  labs(x = "Sólidos solubles (°Brix)", y ="Días")+
  annotate("text", x = 9.33  , y = 1.2 , label = "a", size=6)+
  annotate("text", x = 7.73  , y = 2.2 , label = "b", size=6)+
  annotate("text", x = 6.73  , y = 3.2 , label = "b", size=6)+
  theme_classic()+
  theme(panel.grid.major.y = element_line(size=0.05, color='black'))+
  theme(panel.grid.major.x = element_blank())+
  theme(text = element_text(size=32, color='black'))+
  theme(axis.text = element_text(color='black'))+
  scale_x_continuous(limits = c(5, 11), breaks = seq(5, 11, 1))
gg_Comp_modelo_aao_2

```



## PCA

```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(readxl)
almacenamiento <- read_excel("database.xlsx", sheet = "UNLP4_PCA")

```

```{r , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

almacenamiento2 <- almacenamiento[,-c(1,7,8)]

# estandarizar

# Seleccionar las columnas numéricas
numeric_cols <- sapply(almacenamiento2, is.numeric)

# Estandarizar las columnas numéricas
datos_estandarizados <- almacenamiento2
datos_estandarizados[, numeric_cols] <- scale(almacenamiento2[, numeric_cols])

```


```{r, echo=FALSE, error=TRUE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

library(dplyr)
library(factoextra)
library(ggplot2)
library(ggrepel)

# Seleccionar las columnas específicas del dataframe
datos_filtrados <- datos_estandarizados %>%
  dplyr::select(Firmeza, L_color, a_color, b_color, aao_0.125, Fenoles, Carotenoides, Clo_a, Clo_b, pH, ATT, Sólidos, Respiración, Ratio)
  
# dplyr::select(TFS, FNP, FFWP, CO2)
# 
  # dplyr::select(PS, FIRMEZA, DT, PH, CO2, DL, NUPRORAFRU, NUFRU, PF)

# Realizar el PCA
pca_result <- prcomp(datos_filtrados, center = TRUE, scale. = TRUE)

pca_scores <- as.data.frame(pca_result$x[,c(1:3)])
pca_scores$Día <- as.factor(almacenamiento$Día)


# Ver resumen del PCA
summary(pca_result)

# Ver los loadings (contribuciones de cada variable a los componentes principales)
# print(pca_result$rotation)

# Ver los scores (valores de las muestras en los componentes principales)
# head(pca_result$x)

```

```{r , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

pca_var <- get_pca_var(pca_result)
# Ordenar las variables por contribución para Dim.1 (PC1)
pca_var_dim1 <- pca_var$contrib[, 1] %>% sort(decreasing = TRUE)
pca_var_dim1

# Ordenar las variables por contribución para Dim.2 (PC2)
pca_var_dim2 <- pca_var$contrib[, 2] %>% sort(decreasing = TRUE)
pca_var_dim2

```

```{r, echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=10, fig.height=8}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
# Contribución acumulada de cada variable a CP1 y CP2
# # Asegurarse de que los nombres de las variables coincidan entre los dos vectores
# common_names <- intersect(names(pca_var_dim1), names(pca_var_dim2))
# 
# # Filtrar solo las variables comunes
# pca_var_dim1_filtered <- pca_var_dim1[common_names]
# pca_var_dim2_filtered <- pca_var_dim2[common_names]
# # Sumar las contribuciones de cada variable en los dos componentes
# combined_contributions <- pca_var_dim1_filtered + pca_var_dim2_filtered
# 
# # Ordenar las variables por su contribución acumulada
# sorted_contributions <- sort(combined_contributions, decreasing = TRUE)
# 
# # Mostrar el resultado
# sorted_contributions

```

Biplot
```{r , echo=FALSE, fig.align='center', fig.asp=0.4, fig.width=24, fig.height=16}
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)

# c("#A6CEE3", "#1F78B4", "#B2DF8A", "#33A02C", "#FB9A99",
# "#E31A1C", "#FDBF6F", "#FF7F00", "#CAB2D6", "#6A3D9A",
# "#FFFF00", "#B15928")

rownames(pca_result$rotation)[1] <- "PEN"
rownames(pca_result$rotation)[2] <- "L*"
rownames(pca_result$rotation)[3] <- "a*"
rownames(pca_result$rotation)[4] <- "b*"
rownames(pca_result$rotation)[5] <- "DPPH25"
rownames(pca_result$rotation)[6] <- "PT"
rownames(pca_result$rotation)[7] <- "CTC"
rownames(pca_result$rotation)[8] <- "CLa"
rownames(pca_result$rotation)[9] <- "CLb"
rownames(pca_result$rotation)[10] <- "pH"
rownames(pca_result$rotation)[11] <- "ATT"
rownames(pca_result$rotation)[12] <- "SS"
rownames(pca_result$rotation)[14] <- "SS/ATT"

# Recalcular el biplot
biplot_modificado <- fviz_pca_biplot(pca_result,
                                     # ... Resto de tu código
                                     )

biplot_almacenamiento <- fviz_pca_biplot(pca_result, 
                                geom.ind = "point",           # Puntos para los individuos
                                pointshape = 21,              # Forma de los puntos
                                pointsize = 6,                # Tamaño de los puntos
                                geom.var = c("point", "text"), # Puntos y texto para las variables
                                labelsize = 8,               # Tamaño del texto
                                col.ind = "black",            # Color del borde de los puntos
                                repel = TRUE,                 # Evitar superposición de etiquetas
                                addEllipses = FALSE,          # No agregar elipses
                                label = "var",                # Etiquetar las variables
                                col.var = "black",            # Color de las variables
                                arrows = TRUE) +
  geom_point(data = pca_scores,
             aes(x = PC1, y = PC2, color = Día), size = 12) +
  scale_color_manual(values = c("#FF8","orange","brown4")) +
  theme_classic() +
  labs(title = "", x = "PC1 (84,31 %)", y = "PC2 (15,69 %)") +
  theme(legend.position = "bottom",
        text = element_text(size = 38, color = 'black'),
        axis.text = element_text(color = 'black')) +
  geom_smooth(data = pca_scores,
             aes(x = PC1, y = PC2),
             method = "loess",
             se = FALSE,
             color = "gray50",
             linetype = 3,
             span = 0.85)
biplot_almacenamiento

# ggsave("biplot_almacenamiento.tiff", plot = biplot_almacenamiento, device = "tiff", width = 15, height = 8, units = "in", dpi = 300)

```

